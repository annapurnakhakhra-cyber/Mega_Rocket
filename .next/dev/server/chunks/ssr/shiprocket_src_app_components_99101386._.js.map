{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Desktop/next-shiprocket/shiprocket/src/app/components/LoginStep.js"],"sourcesContent":["// shiprocket/src/app/components/LoginStep.js - (Same as before, using the /api/user-data endpoint)\r\n\r\nimport React, { useState } from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faSpinner } from '@fortawesome/free-solid-svg-icons';\r\n\r\nconst LoginStep = ({ onLoginSuccess }) => {\r\n    // Setting a default number for easy testing, but this should be dynamic\r\n    const [mobile, setMobile] = useState('9876543210'); \r\n    const [otp, setOtp] = useState('');\r\n    const [isOtpSent, setIsOtpSent] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    const handleSendOtp = async () => {\r\n        if (mobile.length !== 10) return;\r\n        setIsLoading(true);\r\n        // Simulate OTP sending delay\r\n        await new Promise(resolve => setTimeout(resolve, 1500)); \r\n        \r\n        setIsOtpSent(true); \r\n        alert(`DEMO: OTP sent to +91 ${mobile}. Use 1234 to verify. Check server console for dynamic DB attempt.`); \r\n        setIsLoading(false);\r\n    };\r\n\r\n    const handleVerifyOtp = async () => {\r\n        if (otp !== '1234') { \r\n            alert('Invalid OTP. Please use 1234.');\r\n            return;\r\n        }\r\n        setIsLoading(true);\r\n        \r\n        // ‚≠êÔ∏è DYNAMIC DATA FETCHING LOGIC (API Call) ‚≠êÔ∏è\r\n        try {\r\n            const response = await fetch('/api/user-data', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ mobile: mobile }) // Send the mobile number to API\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const errorData = await response.json();\r\n                throw new Error(errorData.message || 'Failed to fetch user data from API.');\r\n            }\r\n\r\n            // üü¢ SUCCESS: Receive dynamic data from the API\r\n            const userData = await response.json(); \r\n            \r\n            console.log(\"‚úÖ Dynamic User Data Received:\", userData);\r\n            \r\n            onLoginSuccess(userData);\r\n\r\n        } catch (error) {\r\n            console.error(\"Login verification failed:\", error);\r\n            alert(`Login Failed: ${error.message}`);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <h3 className=\"text-2xl font-bold text-blue-600\">\r\n                {isOtpSent ? 'Verify OTP' : 'Quick Login'}\r\n            </h3>\r\n            \r\n            {!isOtpSent ? (\r\n                <div className=\"space-y-4\">\r\n                    <input\r\n                        type=\"tel\"\r\n                        className=\"w-full p-4 border-2 border-gray-300 rounded-lg text-lg focus:ring-blue-500 focus:border-blue-500\"\r\n                        placeholder=\"10 digit Mobile Number\"\r\n                        value={mobile}\r\n                        onChange={(e) => setMobile(e.target.value)}\r\n                        maxLength={10}\r\n                        disabled={isLoading}\r\n                    />\r\n                    <button\r\n                        onClick={handleSendOtp}\r\n                        disabled={isLoading || mobile.length !== 10}\r\n                        className=\"w-full bg-blue-600 text-white p-3 rounded-lg font-bold hover:bg-blue-700 disabled:bg-blue-300 flex items-center justify-center shadow-md\"\r\n                    >\r\n                        {isLoading ? <FontAwesomeIcon icon={faSpinner} spin className=\"mr-2\" /> : 'Get OTP & Auto-fill'}\r\n                    </button>\r\n                </div>\r\n            ) : (\r\n                <div className=\"space-y-4\">\r\n                    <input\r\n                        type=\"text\"\r\n                        className=\"w-full p-4 border-2 border-gray-300 rounded-lg text-lg text-center tracking-widest focus:ring-green-500 focus:border-green-500\"\r\n                        placeholder=\"XXXX\"\r\n                        value={otp}\r\n                        onChange={(e) => setOtp(e.target.value)}\r\n                        maxLength={4}\r\n                        disabled={isLoading}\r\n                    />\r\n                    <button\r\n                        onClick={handleVerifyOtp}\r\n                        disabled={isLoading || otp.length !== 4}\r\n                        className=\"w-full bg-green-600 text-white p-3 rounded-lg font-bold hover:bg-green-700 disabled:bg-green-300 flex items-center justify-center shadow-md\"\r\n                    >\r\n                        {isLoading ? <FontAwesomeIcon icon={faSpinner} spin className=\"mr-2\" /> : 'Verify OTP'}\r\n                    </button>\r\n                    <button \r\n                        onClick={() => setIsOtpSent(false)} \r\n                        className=\"w-full text-blue-600 text-sm mt-2 hover:underline\"\r\n                    >\r\n                        Change Number\r\n                    </button>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default LoginStep;"],"names":[],"mappings":"AAAA,mGAAmG;;;;;;AAEnG;AACA;AACA;;;;;AAEA,MAAM,YAAY,CAAC,EAAE,cAAc,EAAE;IACjC,wEAAwE;IACxE,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,+NAAQ,EAAC;IACrC,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,+NAAQ,EAAC;IAC/B,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,+NAAQ,EAAC;IAC3C,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,+NAAQ,EAAC;IAE3C,MAAM,gBAAgB;QAClB,IAAI,OAAO,MAAM,KAAK,IAAI;QAC1B,aAAa;QACb,6BAA6B;QAC7B,MAAM,IAAI,QAAQ,CAAA,UAAW,WAAW,SAAS;QAEjD,aAAa;QACb,MAAM,CAAC,sBAAsB,EAAE,OAAO,kEAAkE,CAAC;QACzG,aAAa;IACjB;IAEA,MAAM,kBAAkB;QACpB,IAAI,QAAQ,QAAQ;YAChB,MAAM;YACN;QACJ;QACA,aAAa;QAEb,+CAA+C;QAC/C,IAAI;YACA,MAAM,WAAW,MAAM,MAAM,kBAAkB;gBAC3C,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE,QAAQ;gBAAO,GAAG,gCAAgC;YAC7E;YAEA,IAAI,CAAC,SAAS,EAAE,EAAE;gBACd,MAAM,YAAY,MAAM,SAAS,IAAI;gBACrC,MAAM,IAAI,MAAM,UAAU,OAAO,IAAI;YACzC;YAEA,gDAAgD;YAChD,MAAM,WAAW,MAAM,SAAS,IAAI;YAEpC,QAAQ,GAAG,CAAC,iCAAiC;YAE7C,eAAe;QAEnB,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,8BAA8B;YAC5C,MAAM,CAAC,cAAc,EAAE,MAAM,OAAO,EAAE;QAC1C,SAAU;YACN,aAAa;QACjB;IACJ;IAEA,qBACI,4PAAC;QAAI,WAAU;;0BACX,4PAAC;gBAAG,WAAU;0BACT,YAAY,eAAe;;;;;;YAG/B,CAAC,0BACE,4PAAC;gBAAI,WAAU;;kCACX,4PAAC;wBACG,MAAK;wBACL,WAAU;wBACV,aAAY;wBACZ,OAAO;wBACP,UAAU,CAAC,IAAM,UAAU,EAAE,MAAM,CAAC,KAAK;wBACzC,WAAW;wBACX,UAAU;;;;;;kCAEd,4PAAC;wBACG,SAAS;wBACT,UAAU,aAAa,OAAO,MAAM,KAAK;wBACzC,WAAU;kCAET,0BAAY,4PAAC,uMAAe;4BAAC,MAAM,mMAAS;4BAAE,IAAI;4BAAC,WAAU;;;;;uEAAY;;;;;;;;;;;yEAIlF,4PAAC;gBAAI,WAAU;;kCACX,4PAAC;wBACG,MAAK;wBACL,WAAU;wBACV,aAAY;wBACZ,OAAO;wBACP,UAAU,CAAC,IAAM,OAAO,EAAE,MAAM,CAAC,KAAK;wBACtC,WAAW;wBACX,UAAU;;;;;;kCAEd,4PAAC;wBACG,SAAS;wBACT,UAAU,aAAa,IAAI,MAAM,KAAK;wBACtC,WAAU;kCAET,0BAAY,4PAAC,uMAAe;4BAAC,MAAM,mMAAS;4BAAE,IAAI;4BAAC,WAAU;;;;;uEAAY;;;;;;kCAE9E,4PAAC;wBACG,SAAS,IAAM,aAAa;wBAC5B,WAAU;kCACb;;;;;;;;;;;;;;;;;;AAOrB;uCAEe"}},
    {"offset": {"line": 175, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Desktop/next-shiprocket/shiprocket/src/app/components/AddressStep.js"],"sourcesContent":["// shiprocket/src/app/components/AddressStep.js\r\n\r\nimport React, { useState } from 'react';\r\n\r\n// --- External Data: Comprehensive Country List ---\r\nconst COUNTRIES = [\r\n    { code: '', name: 'Select Country/Region *' }, // Placeholder\r\n    { code: 'IN', name: 'India' },\r\n    { code: 'US', name: 'United States' },\r\n    { code: 'GB', name: 'United Kingdom' },\r\n    { code: 'CA', name: 'Canada' },\r\n    { code: 'AU', name: 'Australia' },\r\n    { code: 'DE', name: 'Germany' },\r\n    { code: 'FR', name: 'France' },\r\n    { code: 'AE', name: 'United Arab Emirates' },\r\n    { code: 'SG', name: 'Singapore' },\r\n    // Add many more countries here...\r\n];\r\n// ------------------------------------------------\r\n\r\nconst AddressStep = ({ initialAddress, onAddressConfirm, userName }) => {\r\n    // Expanded state structure to handle all address fields\r\n    const [address, setAddress] = useState(initialAddress || {\r\n        country: '', \r\n        first_name: '',\r\n        last_name: '',\r\n        line1: '', \r\n        address2: '', \r\n        city: '',\r\n        state: '',\r\n        pincode: '',\r\n        saveInfo: true, \r\n    });\r\n\r\n    const handleChange = (e) => {\r\n        const { name, value, type, checked } = e.target;\r\n        \r\n        setAddress(prev => ({ \r\n            ...prev, \r\n            [name]: type === 'checkbox' ? checked : value \r\n        }));\r\n    };\r\n\r\n    const handleSubmit = (e) => {\r\n        e.preventDefault();\r\n        \r\n        // Input validation check for required fields\r\n        if (!address.country || address.country === '' || !address.first_name || !address.last_name || !address.line1 || !address.city || !address.state || !address.pincode) {\r\n            alert('Please fill in all required address fields (marked with *), including Country/Region.');\r\n            return;\r\n        }\r\n        \r\n        onAddressConfirm(address);\r\n    };\r\n\r\n    // Check if initialAddress exists and has the primary address line to confirm auto-fill\r\n    const isAddressAutoFilled = initialAddress && initialAddress.line1 !== '';\r\n\r\n    return (\r\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n            <h3 className=\"text-2xl font-bold text-blue-600\">Delivery Address</h3>\r\n            \r\n            {/* Auto-fill Notification */}\r\n            {isAddressAutoFilled && (\r\n                <div className=\"p-4 bg-yellow-100 border border-yellow-300 rounded-lg text-sm font-semibold\">\r\n                    üëã Welcome back, {userName}! Your address is auto-filled.\r\n                </div>\r\n            )}\r\n\r\n            {/* Country/Region Selector */}\r\n            <select\r\n                name=\"country\"\r\n                value={address.country}\r\n                onChange={handleChange}\r\n                className=\"w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500\"\r\n                required\r\n            >\r\n                {COUNTRIES.map((country) => (\r\n                    <option \r\n                        key={country.code} \r\n                        value={country.code} \r\n                        disabled={country.code === ''}\r\n                    >\r\n                        {country.name}\r\n                    </option>\r\n                ))}\r\n            </select>\r\n            \r\n            {/* First Name and Last Name */}\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n                <input \r\n                    type=\"text\" name=\"first_name\" placeholder=\"First Name *\" \r\n                    value={address.first_name} onChange={handleChange} \r\n                    className=\"p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500\" \r\n                    required \r\n                />\r\n                <input \r\n                    type=\"text\" name=\"last_name\" placeholder=\"Last Name *\" \r\n                    value={address.last_name} onChange={handleChange} \r\n                    className=\"p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500\" \r\n                    required \r\n                />\r\n            </div>\r\n\r\n            {/* Address (Line 1) */}\r\n            <input \r\n                type=\"text\" \r\n                name=\"line1\" \r\n                placeholder=\"Address (Street, House No., Locality) *\" \r\n                value={address.line1} \r\n                onChange={handleChange} \r\n                className=\"w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500\" \r\n                required \r\n            />\r\n\r\n            {/* Address Line 2 (Apartment, suite, etc. - Optional field) */}\r\n            <input \r\n                type=\"text\" \r\n                name=\"address2\" \r\n                placeholder=\"Apartment, suite, building, etc. (Optional)\" \r\n                value={address.address2} \r\n                onChange={handleChange} \r\n                className=\"w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500\" \r\n            />\r\n\r\n            {/* City, State, Pincode */}\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n                <input \r\n                    type=\"text\" name=\"city\" placeholder=\"City *\" \r\n                    value={address.city} onChange={handleChange} \r\n                    className=\"p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500\" \r\n                    required \r\n                />\r\n                <input \r\n                    type=\"text\" name=\"state\" placeholder=\"State *\" \r\n                    value={address.state} onChange={handleChange} \r\n                    className=\"p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500\" \r\n                    required \r\n                />\r\n            </div>\r\n            <input \r\n                type=\"text\" name=\"pincode\" placeholder=\"Pincode *\" \r\n                value={address.pincode} onChange={handleChange} \r\n                className=\"w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500\" \r\n                required \r\n            />\r\n\r\n            {/* Save Information Checkbox */}\r\n            <div className=\"flex items-center pt-2\">\r\n                <input\r\n                    type=\"checkbox\"\r\n                    id=\"saveInfo\"\r\n                    name=\"saveInfo\"\r\n                    checked={address.saveInfo}\r\n                    onChange={handleChange}\r\n                    className=\"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500\"\r\n                />\r\n                <label htmlFor=\"saveInfo\" className=\"ml-2 block text-base text-gray-900 font-medium\">\r\n                    Save this information for next time\r\n                </label>\r\n            </div>\r\n            \r\n            <button\r\n                type=\"submit\"\r\n                className=\"w-full bg-blue-600 text-white p-3 rounded-lg font-bold hover:bg-blue-700 mt-6\"\r\n            >\r\n                Proceed to Payment\r\n            </button>\r\n        </form>\r\n    );\r\n};\r\n\r\nexport default AddressStep;"],"names":[],"mappings":"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"}},
    {"offset": {"line": 462, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Desktop/next-shiprocket/shiprocket/src/app/components/PaymentStep.js"],"sourcesContent":["// shiprocket/src/app/components/PaymentStep.js\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faSpinner, faArrowLeft, faTimesCircle, faCheckCircle, faQrcode, faTag } from '@fortawesome/free-solid-svg-icons';\r\n\r\n// --- SIMULATED DISCOUNT LOGIC (Dynamic Promo Codes) ---\r\nconst verifyPromoCode = (code, subtotal) => {\r\n    const defaultDiscount = 50; // Base discount for prepaid orders\r\n    \r\n    const upperCaseCode = code.toUpperCase(); \r\n\r\n    if (upperCaseCode === 'FLAT100') {\r\n        return {\r\n            valid: true,\r\n            amount: 100, // Flat discount of 100\r\n            message: \"FLAT100 applied successfully! Saved ‚Çπ100.\",\r\n        };\r\n    } \r\n    if (upperCaseCode === 'FESTIVE10') {\r\n        const percentDiscount = Math.min(250, subtotal * 0.10); // 10% off, max ‚Çπ250\r\n        return {\r\n            valid: true,\r\n            amount: parseFloat(percentDiscount.toFixed(2)), \r\n            message: \"FESTIVE10 applied! 10% off (Max ‚Çπ250).\",\r\n        };\r\n    } \r\n    \r\n    if (code === '') {\r\n        return { valid: true, amount: defaultDiscount, message: \"Prepaid discount applied.\" };\r\n    }\r\n\r\n    return {\r\n        valid: false,\r\n        amount: 0,\r\n        message: \"Invalid or expired promo code.\",\r\n    };\r\n};\r\n\r\n\r\n// --- SIMULATED ORDER DATA (MODIFIED to accept Dynamic Discount) ---\r\nconst getSimulatedOrderData = (isCodSelected, initialOrderItems, appliedDiscountAmount) => {\r\n    const BASE_TOTAL = initialOrderItems.reduce((acc, item) => acc + (item.base_price * item.quantity), 0); \r\n    \r\n    const SHIPPING_CHARGE = 80;\r\n    const COD_CHARGE = 40;\r\n    const TAX_RATE = 0.05; \r\n\r\n    const subtotal = BASE_TOTAL;\r\n    \r\n    const discount = isCodSelected ? 0 : appliedDiscountAmount; \r\n\r\n    const taxableBase = subtotal - discount;\r\n    const taxAmount = parseFloat((taxableBase * TAX_RATE).toFixed(2));\r\n    \r\n    let finalTotal = taxableBase + SHIPPING_CHARGE + taxAmount;\r\n    \r\n    const paymentFee = isCodSelected ? COD_CHARGE : 0;\r\n    finalTotal += paymentFee;\r\n\r\n    return {\r\n        subtotal: subtotal, discount: discount, taxRate: TAX_RATE, taxAmount: taxAmount,\r\n        shipping: { method: 'Standard Shipping (3-5 days)', charge: SHIPPING_CHARGE, isFree: false, },\r\n        paymentFee: paymentFee, isCodSelected: isCodSelected,\r\n        totalPayable: parseFloat(finalTotal.toFixed(2)),\r\n    };\r\n};\r\n// ----------------------------------------------------------------------\r\n\r\n\r\n// ‚≠êÔ∏è NEW UI/UX COMPONENT: QR Code Overlay ‚≠êÔ∏è\r\nconst QrCodeOverlay = ({ totalPayable, onGoBack, onOrderPlace, isLoading }) => {\r\n    const [timeLeft, setTimeLeft] = useState(300); // 5 minutes in seconds\r\n    const [paymentStatus, setPaymentStatus] = useState('pending'); // pending, success, failed\r\n\r\n    useEffect(() => {\r\n        if (timeLeft <= 0 || paymentStatus !== 'pending') return;\r\n\r\n        const timerId = setInterval(() => {\r\n            setTimeLeft(prevTime => prevTime - 1);\r\n        }, 1000);\r\n\r\n        return () => clearInterval(timerId);\r\n    }, [timeLeft, paymentStatus]);\r\n\r\n    const minutes = Math.floor(timeLeft / 60);\r\n    const seconds = timeLeft % 60;\r\n    const formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\r\n    \r\n    const mockUpiData = `upi://pay?pa=mockvpa@bank&pn=Merchant%20Name&mc=1234&tid=TID${Date.now()}&am=${totalPayable.toFixed(2)}&cu=INR`;\r\n    const qrCodeUrl = `https://chart.googleapis.com/chart?cht=qr&chs=250x250&chl=${encodeURIComponent(mockUpiData)}`;\r\n    \r\n    const handleManualConfirm = () => {\r\n        setPaymentStatus('success');\r\n        setTimeout(() => onOrderPlace(), 1000);\r\n    }\r\n    \r\n    let statusIcon, statusText, statusColor;\r\n    if (paymentStatus === 'pending') {\r\n        statusIcon = faQrcode;\r\n        statusText = `Scan the QR code to pay ‚Çπ${totalPayable.toFixed(2)}`;\r\n        statusColor = 'text-blue-600';\r\n    } else if (paymentStatus === 'success') {\r\n        statusIcon = faCheckCircle;\r\n        statusText = 'Payment Received! Finalizing order...';\r\n        statusColor = 'text-green-600';\r\n    } else {\r\n        statusIcon = faTimesCircle;\r\n        statusText = 'Payment Expired or Failed. Please retry.';\r\n        statusColor = 'text-red-600';\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-6 text-center\">\r\n            <button \r\n                onClick={onGoBack}\r\n                className=\"flex items-center text-gray-500 hover:text-gray-800 transition duration-150\"\r\n                disabled={paymentStatus !== 'pending'}\r\n            >\r\n                <FontAwesomeIcon icon={faArrowLeft} className=\"mr-2\" />\r\n                Back to Options\r\n            </button>\r\n            \r\n            <h3 className={`text-3xl font-extrabold ${statusColor}`}>\r\n                <FontAwesomeIcon icon={statusIcon} className=\"mr-3\" />\r\n                {statusText}\r\n            </h3>\r\n            \r\n            <div className=\"p-4 bg-white border border-gray-100 rounded-lg shadow-xl mx-auto max-w-xs\">\r\n                 <img src={qrCodeUrl} alt=\"UPI Payment QR Code\" className=\"w-full h-auto border p-2\" />\r\n            </div>\r\n            \r\n            <div className=\"font-semibold text-gray-700\">\r\n                <p>Total Payable: <span className=\"text-2xl font-bold text-red-600\">‚Çπ{totalPayable.toFixed(2)}</span></p>\r\n            </div>\r\n            \r\n            <div className={`p-3 rounded-lg font-bold mx-auto w-3/4 ${paymentStatus === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-500'}`}>\r\n                {paymentStatus === 'pending' ? (\r\n                    `Time Remaining: ${formattedTime}`\r\n                ) : (\r\n                    'Payment gateway finalized.'\r\n                )}\r\n            </div>\r\n            \r\n            {paymentStatus === 'pending' && (\r\n                 <button\r\n                    onClick={handleManualConfirm} \r\n                    disabled={isLoading || timeLeft <= 0}\r\n                    className=\"w-full bg-green-600 text-white p-3 rounded-lg font-bold text-lg hover:bg-green-700 disabled:bg-gray-400 flex items-center justify-center shadow-lg\"\r\n                >\r\n                    {isLoading ? (\r\n                        <>\r\n                            <FontAwesomeIcon icon={faSpinner} spin className=\"mr-2\" />\r\n                            Checking Payment Status...\r\n                        </>\r\n                    ) : (\r\n                        'I have Paid - Confirm Order'\r\n                    )}\r\n                </button>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n// ----------------------------------------------------------------------\r\n\r\n\r\nconst PaymentStep = ({ onOrderPlace, onFinalizeAddress, isLoading, initialOrderItems }) => {\r\n    const [selectedPayment, setSelectedPayment] = useState('prepaid');\r\n    const [showQrCode, setShowQrCode] = useState(false); \r\n    \r\n    // ‚≠êÔ∏è NEW DISCOUNT STATES ‚≠êÔ∏è\r\n    const [promoCode, setPromoCode] = useState('');\r\n    const [appliedDiscount, setAppliedDiscount] = useState({ \r\n        amount: 50, // Default prepaid discount\r\n        message: 'Prepaid discount applied.',\r\n        valid: true \r\n    });\r\n\r\n    // üî¥ FIX: Define the banner object here to fix \"banner is not defined\" error\r\n    const banner = {\r\n        bgColor: '#F74435', \r\n        textColor: '#FFFFFF',\r\n        text: 'Prepaid 5% discount | COD Rs.40 Extra',\r\n    };\r\n    // -------------------------------------------------------------------\r\n\r\n    const isCodSelected = selectedPayment === 'cod';\r\n    const subtotal = initialOrderItems.reduce((acc, item) => acc + (item.base_price * item.quantity), 0); \r\n    \r\n    const effectiveDiscountAmount = isCodSelected ? 0 : appliedDiscount.amount;\r\n    \r\n    const orderDetails = getSimulatedOrderData(isCodSelected, initialOrderItems, effectiveDiscountAmount);\r\n    const { \r\n        taxAmount, shipping, paymentFee, totalPayable \r\n    } = orderDetails;\r\n\r\n    // --- EFFECT: Update Parent State on Change ---\r\n    useEffect(() => {\r\n        onFinalizeAddress(prev => ({ ...prev, paymentDetails: orderDetails }));\r\n    }, [isCodSelected, onFinalizeAddress, orderDetails]);\r\n    \r\n    // --- EFFECT: Recalculate default discount when changing payment method ---\r\n    useEffect(() => {\r\n        if (!isCodSelected) {\r\n            if (promoCode === '') {\r\n                 setAppliedDiscount(verifyPromoCode('', subtotal));\r\n            } else {\r\n                 handleApplyPromo();\r\n            }\r\n        } else {\r\n            setAppliedDiscount({ amount: 0, message: \"No discount applied for COD.\", valid: true });\r\n        }\r\n    }, [isCodSelected]); \r\n\r\n\r\n    // ‚≠êÔ∏è NEW HANDLER: Apply Promo Code ‚≠êÔ∏è\r\n    const handleApplyPromo = () => {\r\n        if (isCodSelected) {\r\n            alert(\"Promo codes are only applicable for Prepaid orders.\");\r\n            return;\r\n        }\r\n        if (promoCode === '') {\r\n             setAppliedDiscount(verifyPromoCode('', subtotal));\r\n             return;\r\n        }\r\n        \r\n        const result = verifyPromoCode(promoCode, subtotal);\r\n        setAppliedDiscount(result);\r\n    };\r\n\r\n\r\n    const buttonBg = isCodSelected \r\n        ? 'bg-orange-600 hover:bg-orange-700 disabled:bg-orange-400' \r\n        : 'bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400';\r\n    \r\n    const buttonText = isCodSelected \r\n        ? `Confirm COD Order for ‚Çπ${totalPayable.toFixed(2)}` \r\n        : `Pay ‚Çπ${totalPayable.toFixed(2)} & Complete Order`;\r\n\r\n    const paymentOptions = [\r\n        { id: 'prepaid', label: 'UPI / Card / NetBanking (Recommended)' },\r\n        { id: 'cod', label: 'Cash on Delivery (COD)' },\r\n    ];\r\n    \r\n    const handlePaymentAction = () => {\r\n        if (isCodSelected) {\r\n            onOrderPlace();\r\n        } else {\r\n            setShowQrCode(true);\r\n        }\r\n    };\r\n    \r\n    if (showQrCode) {\r\n        return (\r\n            <QrCodeOverlay \r\n                totalPayable={totalPayable}\r\n                onGoBack={() => setShowQrCode(false)}\r\n                onOrderPlace={onOrderPlace}\r\n                isLoading={isLoading}\r\n            />\r\n        );\r\n    }\r\n\r\n    // --- Default Payment Selection Screen Rendering ---\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <h3 className=\"text-2xl font-bold text-blue-600\">Payment Options</h3>\r\n\r\n            {/* Dynamic Banner */}\r\n            <div \r\n                style={{ backgroundColor: banner.bgColor, color: banner.textColor }}\r\n                className=\"p-3 text-center text-sm font-semibold rounded-lg shadow-md\"\r\n            >\r\n                {banner.text}\r\n            </div>\r\n            \r\n            {/* ‚≠êÔ∏è NEW: Discount Input Field ‚≠êÔ∏è */}\r\n            <div className=\"border p-4 rounded-lg shadow-sm space-y-2\">\r\n                <h4 className=\"font-bold text-gray-800 flex items-center\">\r\n                    <FontAwesomeIcon icon={faTag} className=\"mr-2 text-blue-500\" />\r\n                    Have a Promo Code? (FLAT100 / FESTIVE10)\r\n                </h4>\r\n                <div className=\"flex space-x-2\">\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Enter Code\"\r\n                        value={promoCode}\r\n                        onChange={(e) => setPromoCode(e.target.value)}\r\n                        className=\"flex-grow p-2 border-2 border-gray-300 rounded-lg focus:border-blue-500\"\r\n                        disabled={isCodSelected}\r\n                    />\r\n                    <button\r\n                        onClick={handleApplyPromo}\r\n                        disabled={isLoading || isCodSelected}\r\n                        className={`p-2 rounded-lg font-semibold text-white transition duration-150 ${\r\n                            isCodSelected ? 'bg-gray-400' : 'bg-green-600 hover:bg-green-700'\r\n                        }`}\r\n                    >\r\n                        Apply\r\n                    </button>\r\n                </div>\r\n                {/* Discount Message */}\r\n                <p className={`text-sm ${appliedDiscount.valid ? 'text-green-600' : 'text-red-600'}`}>\r\n                    {appliedDiscount.message}\r\n                </p>\r\n            </div>\r\n            {/* End Discount Input Field */}\r\n\r\n\r\n            {/* Payment Options Selection */}\r\n            <div className=\"space-y-3\">\r\n                {paymentOptions.map((option) => (\r\n                    <label \r\n                        key={option.id} \r\n                        className={`flex justify-between items-center p-4 border-2 rounded-lg cursor-pointer transition-all ${\r\n                            selectedPayment === option.id \r\n                            ? 'border-blue-600 bg-blue-50 shadow-sm' \r\n                            : 'border-gray-300'\r\n                        }`}\r\n                    >\r\n                        <span className=\"ml-3 font-medium text-gray-700\">{option.label}</span>\r\n                         <input\r\n                            type=\"radio\"\r\n                            name=\"payment\"\r\n                            value={option.id}\r\n                            checked={selectedPayment === option.id}\r\n                            onChange={(e) => setSelectedPayment(e.target.value)}\r\n                            className=\"h-5 w-5 text-blue-600 focus:ring-blue-500\"\r\n                        />\r\n                    </label>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Order Summary */}\r\n            <div className=\"border-t pt-4 space-y-2 text-sm\">\r\n                <p className=\"flex justify-between font-medium\"><span>Subtotal (Items):</span> <span>‚Çπ{subtotal.toFixed(2)}</span></p>\r\n                \r\n                <p className=\"flex justify-between font-medium\" style={{ color: effectiveDiscountAmount > 0 ? '#10B981' : '#EF4444' }}>\r\n                    <span>Discount Applied:</span> <span>- ‚Çπ{effectiveDiscountAmount.toFixed(2)}</span>\r\n                </p>\r\n\r\n                <p className=\"flex justify-between font-medium text-gray-700\">\r\n                    <span>Shipping ({shipping.method}):</span> <span>+ ‚Çπ{shipping.charge.toFixed(2)}</span>\r\n                </p>\r\n                <p className=\"flex justify-between font-medium text-gray-700\">\r\n                    <span>Taxes ({(orderDetails.taxRate * 100).toFixed(0)}%):</span> <span>+ ‚Çπ{taxAmount.toFixed(2)}</span>\r\n                </p>\r\n                {paymentFee > 0 && (\r\n                    <p className=\"flex justify-between text-red-600 font-semibold\">\r\n                        <span>COD Convenience Fee:</span> <span>+ ‚Çπ{paymentFee.toFixed(2)}</span>\r\n                    </p>\r\n                )}\r\n                <p className=\"flex justify-between text-xl font-extrabold border-t-2 pt-2\">\r\n                    <span>Total Payable:</span> <span className=\"text-red-600\">‚Çπ{totalPayable.toFixed(2)}</span>\r\n                </p>\r\n            </div>\r\n\r\n            <button\r\n                onClick={handlePaymentAction}\r\n                disabled={isLoading}\r\n                className={`w-full text-white p-3 rounded-lg font-bold text-lg shadow-lg flex items-center justify-center ${buttonBg}`}\r\n            >\r\n                {isLoading ? (\r\n                    <>\r\n                        <FontAwesomeIcon icon={faSpinner} spin className=\"mr-2\" />\r\n                        Processing...\r\n                    </>\r\n                ) : (\r\n                    buttonText\r\n                )}\r\n            </button>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default PaymentStep;"],"names":[],"mappings":"AAAA,+CAA+C;;;;;;AAE/C;AACA;AACA;;;;;AAEA,yDAAyD;AACzD,MAAM,kBAAkB,CAAC,MAAM;IAC3B,MAAM,kBAAkB,IAAI,mCAAmC;IAE/D,MAAM,gBAAgB,KAAK,WAAW;IAEtC,IAAI,kBAAkB,WAAW;QAC7B,OAAO;YACH,OAAO;YACP,QAAQ;YACR,SAAS;QACb;IACJ;IACA,IAAI,kBAAkB,aAAa;QAC/B,MAAM,kBAAkB,KAAK,GAAG,CAAC,KAAK,WAAW,OAAO,oBAAoB;QAC5E,OAAO;YACH,OAAO;YACP,QAAQ,WAAW,gBAAgB,OAAO,CAAC;YAC3C,SAAS;QACb;IACJ;IAEA,IAAI,SAAS,IAAI;QACb,OAAO;YAAE,OAAO;YAAM,QAAQ;YAAiB,SAAS;QAA4B;IACxF;IAEA,OAAO;QACH,OAAO;QACP,QAAQ;QACR,SAAS;IACb;AACJ;AAGA,qEAAqE;AACrE,MAAM,wBAAwB,CAAC,eAAe,mBAAmB;IAC7D,MAAM,aAAa,kBAAkB,MAAM,CAAC,CAAC,KAAK,OAAS,MAAO,KAAK,UAAU,GAAG,KAAK,QAAQ,EAAG;IAEpG,MAAM,kBAAkB;IACxB,MAAM,aAAa;IACnB,MAAM,WAAW;IAEjB,MAAM,WAAW;IAEjB,MAAM,WAAW,gBAAgB,IAAI;IAErC,MAAM,cAAc,WAAW;IAC/B,MAAM,YAAY,WAAW,CAAC,cAAc,QAAQ,EAAE,OAAO,CAAC;IAE9D,IAAI,aAAa,cAAc,kBAAkB;IAEjD,MAAM,aAAa,gBAAgB,aAAa;IAChD,cAAc;IAEd,OAAO;QACH,UAAU;QAAU,UAAU;QAAU,SAAS;QAAU,WAAW;QACtE,UAAU;YAAE,QAAQ;YAAgC,QAAQ;YAAiB,QAAQ;QAAO;QAC5F,YAAY;QAAY,eAAe;QACvC,cAAc,WAAW,WAAW,OAAO,CAAC;IAChD;AACJ;AACA,yEAAyE;AAGzE,6CAA6C;AAC7C,MAAM,gBAAgB,CAAC,EAAE,YAAY,EAAE,QAAQ,EAAE,YAAY,EAAE,SAAS,EAAE;IACtE,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,+NAAQ,EAAC,MAAM,uBAAuB;IACtE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,+NAAQ,EAAC,YAAY,2BAA2B;IAE1F,IAAA,gOAAS,EAAC;QACN,IAAI,YAAY,KAAK,kBAAkB,WAAW;QAElD,MAAM,UAAU,YAAY;YACxB,YAAY,CAAA,WAAY,WAAW;QACvC,GAAG;QAEH,OAAO,IAAM,cAAc;IAC/B,GAAG;QAAC;QAAU;KAAc;IAE5B,MAAM,UAAU,KAAK,KAAK,CAAC,WAAW;IACtC,MAAM,UAAU,WAAW;IAC3B,MAAM,gBAAgB,GAAG,QAAQ,QAAQ,GAAG,QAAQ,CAAC,GAAG,KAAK,CAAC,EAAE,QAAQ,QAAQ,GAAG,QAAQ,CAAC,GAAG,MAAM;IAErG,MAAM,cAAc,CAAC,4DAA4D,EAAE,KAAK,GAAG,GAAG,IAAI,EAAE,aAAa,OAAO,CAAC,GAAG,OAAO,CAAC;IACpI,MAAM,YAAY,CAAC,0DAA0D,EAAE,mBAAmB,cAAc;IAEhH,MAAM,sBAAsB;QACxB,iBAAiB;QACjB,WAAW,IAAM,gBAAgB;IACrC;IAEA,IAAI,YAAY,YAAY;IAC5B,IAAI,kBAAkB,WAAW;QAC7B,aAAa,kMAAQ;QACrB,aAAa,CAAC,yBAAyB,EAAE,aAAa,OAAO,CAAC,IAAI;QAClE,cAAc;IAClB,OAAO,IAAI,kBAAkB,WAAW;QACpC,aAAa,uMAAa;QAC1B,aAAa;QACb,cAAc;IAClB,OAAO;QACH,aAAa,uMAAa;QAC1B,aAAa;QACb,cAAc;IAClB;IAEA,qBACI,4PAAC;QAAI,WAAU;;0BACX,4PAAC;gBACG,SAAS;gBACT,WAAU;gBACV,UAAU,kBAAkB;;kCAE5B,4PAAC,uMAAe;wBAAC,MAAM,qMAAW;wBAAE,WAAU;;;;;;oBAAS;;;;;;;0BAI3D,4PAAC;gBAAG,WAAW,CAAC,wBAAwB,EAAE,aAAa;;kCACnD,4PAAC,uMAAe;wBAAC,MAAM;wBAAY,WAAU;;;;;;oBAC5C;;;;;;;0BAGL,4PAAC;gBAAI,WAAU;0BACV,cAAA,4PAAC;oBAAI,KAAK;oBAAW,KAAI;oBAAsB,WAAU;;;;;;;;;;;0BAG9D,4PAAC;gBAAI,WAAU;0BACX,cAAA,4PAAC;;wBAAE;sCAAe,4PAAC;4BAAK,WAAU;;gCAAkC;gCAAE,aAAa,OAAO,CAAC;;;;;;;;;;;;;;;;;;0BAG/F,4PAAC;gBAAI,WAAW,CAAC,uCAAuC,EAAE,kBAAkB,YAAY,kCAAkC,6BAA6B;0BAClJ,kBAAkB,YACf,CAAC,gBAAgB,EAAE,eAAe,GAElC;;;;;;YAIP,kBAAkB,2BACd,4PAAC;gBACE,SAAS;gBACT,UAAU,aAAa,YAAY;gBACnC,WAAU;0BAET,0BACG;;sCACI,4PAAC,uMAAe;4BAAC,MAAM,mMAAS;4BAAE,IAAI;4BAAC,WAAU;;;;;;wBAAS;;mCAI9D;;;;;;;;;;;;AAMxB;AACA,yEAAyE;AAGzE,MAAM,cAAc,CAAC,EAAE,YAAY,EAAE,iBAAiB,EAAE,SAAS,EAAE,iBAAiB,EAAE;IAClF,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,+NAAQ,EAAC;IACvD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,+NAAQ,EAAC;IAE7C,4BAA4B;IAC5B,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,+NAAQ,EAAC;IAC3C,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,+NAAQ,EAAC;QACnD,QAAQ;QACR,SAAS;QACT,OAAO;IACX;IAEA,6EAA6E;IAC7E,MAAM,SAAS;QACX,SAAS;QACT,WAAW;QACX,MAAM;IACV;IACA,sEAAsE;IAEtE,MAAM,gBAAgB,oBAAoB;IAC1C,MAAM,WAAW,kBAAkB,MAAM,CAAC,CAAC,KAAK,OAAS,MAAO,KAAK,UAAU,GAAG,KAAK,QAAQ,EAAG;IAElG,MAAM,0BAA0B,gBAAgB,IAAI,gBAAgB,MAAM;IAE1E,MAAM,eAAe,sBAAsB,eAAe,mBAAmB;IAC7E,MAAM,EACF,SAAS,EAAE,QAAQ,EAAE,UAAU,EAAE,YAAY,EAChD,GAAG;IAEJ,gDAAgD;IAChD,IAAA,gOAAS,EAAC;QACN,kBAAkB,CAAA,OAAQ,CAAC;gBAAE,GAAG,IAAI;gBAAE,gBAAgB;YAAa,CAAC;IACxE,GAAG;QAAC;QAAe;QAAmB;KAAa;IAEnD,4EAA4E;IAC5E,IAAA,gOAAS,EAAC;QACN,IAAI,CAAC,eAAe;YAChB,IAAI,cAAc,IAAI;gBACjB,mBAAmB,gBAAgB,IAAI;YAC5C,OAAO;gBACF;YACL;QACJ,OAAO;YACH,mBAAmB;gBAAE,QAAQ;gBAAG,SAAS;gBAAgC,OAAO;YAAK;QACzF;IACJ,GAAG;QAAC;KAAc;IAGlB,sCAAsC;IACtC,MAAM,mBAAmB;QACrB,IAAI,eAAe;YACf,MAAM;YACN;QACJ;QACA,IAAI,cAAc,IAAI;YACjB,mBAAmB,gBAAgB,IAAI;YACvC;QACL;QAEA,MAAM,SAAS,gBAAgB,WAAW;QAC1C,mBAAmB;IACvB;IAGA,MAAM,WAAW,gBACX,6DACA;IAEN,MAAM,aAAa,gBACb,CAAC,uBAAuB,EAAE,aAAa,OAAO,CAAC,IAAI,GACnD,CAAC,KAAK,EAAE,aAAa,OAAO,CAAC,GAAG,iBAAiB,CAAC;IAExD,MAAM,iBAAiB;QACnB;YAAE,IAAI;YAAW,OAAO;QAAwC;QAChE;YAAE,IAAI;YAAO,OAAO;QAAyB;KAChD;IAED,MAAM,sBAAsB;QACxB,IAAI,eAAe;YACf;QACJ,OAAO;YACH,cAAc;QAClB;IACJ;IAEA,IAAI,YAAY;QACZ,qBACI,4PAAC;YACG,cAAc;YACd,UAAU,IAAM,cAAc;YAC9B,cAAc;YACd,WAAW;;;;;;IAGvB;IAEA,qDAAqD;IACrD,qBACI,4PAAC;QAAI,WAAU;;0BACX,4PAAC;gBAAG,WAAU;0BAAmC;;;;;;0BAGjD,4PAAC;gBACG,OAAO;oBAAE,iBAAiB,OAAO,OAAO;oBAAE,OAAO,OAAO,SAAS;gBAAC;gBAClE,WAAU;0BAET,OAAO,IAAI;;;;;;0BAIhB,4PAAC;gBAAI,WAAU;;kCACX,4PAAC;wBAAG,WAAU;;0CACV,4PAAC,uMAAe;gCAAC,MAAM,+LAAK;gCAAE,WAAU;;;;;;4BAAuB;;;;;;;kCAGnE,4PAAC;wBAAI,WAAU;;0CACX,4PAAC;gCACG,MAAK;gCACL,aAAY;gCACZ,OAAO;gCACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;gCAC5C,WAAU;gCACV,UAAU;;;;;;0CAEd,4PAAC;gCACG,SAAS;gCACT,UAAU,aAAa;gCACvB,WAAW,CAAC,gEAAgE,EACxE,gBAAgB,gBAAgB,mCAClC;0CACL;;;;;;;;;;;;kCAKL,4PAAC;wBAAE,WAAW,CAAC,QAAQ,EAAE,gBAAgB,KAAK,GAAG,mBAAmB,gBAAgB;kCAC/E,gBAAgB,OAAO;;;;;;;;;;;;0BAOhC,4PAAC;gBAAI,WAAU;0BACV,eAAe,GAAG,CAAC,CAAC,uBACjB,4PAAC;wBAEG,WAAW,CAAC,wFAAwF,EAChG,oBAAoB,OAAO,EAAE,GAC3B,yCACA,mBACJ;;0CAEF,4PAAC;gCAAK,WAAU;0CAAkC,OAAO,KAAK;;;;;;0CAC7D,4PAAC;gCACE,MAAK;gCACL,MAAK;gCACL,OAAO,OAAO,EAAE;gCAChB,SAAS,oBAAoB,OAAO,EAAE;gCACtC,UAAU,CAAC,IAAM,mBAAmB,EAAE,MAAM,CAAC,KAAK;gCAClD,WAAU;;;;;;;uBAdT,OAAO,EAAE;;;;;;;;;;0BAqB1B,4PAAC;gBAAI,WAAU;;kCACX,4PAAC;wBAAE,WAAU;;0CAAmC,4PAAC;0CAAK;;;;;;4BAAwB;0CAAC,4PAAC;;oCAAK;oCAAE,SAAS,OAAO,CAAC;;;;;;;;;;;;;kCAExG,4PAAC;wBAAE,WAAU;wBAAmC,OAAO;4BAAE,OAAO,0BAA0B,IAAI,YAAY;wBAAU;;0CAChH,4PAAC;0CAAK;;;;;;4BAAwB;0CAAC,4PAAC;;oCAAK;oCAAI,wBAAwB,OAAO,CAAC;;;;;;;;;;;;;kCAG7E,4PAAC;wBAAE,WAAU;;0CACT,4PAAC;;oCAAK;oCAAW,SAAS,MAAM;oCAAC;;;;;;;4BAAS;0CAAC,4PAAC;;oCAAK;oCAAI,SAAS,MAAM,CAAC,OAAO,CAAC;;;;;;;;;;;;;kCAEjF,4PAAC;wBAAE,WAAU;;0CACT,4PAAC;;oCAAK;oCAAQ,CAAC,aAAa,OAAO,GAAG,GAAG,EAAE,OAAO,CAAC;oCAAG;;;;;;;4BAAU;0CAAC,4PAAC;;oCAAK;oCAAI,UAAU,OAAO,CAAC;;;;;;;;;;;;;oBAEhG,aAAa,mBACV,4PAAC;wBAAE,WAAU;;0CACT,4PAAC;0CAAK;;;;;;4BAA2B;0CAAC,4PAAC;;oCAAK;oCAAI,WAAW,OAAO,CAAC;;;;;;;;;;;;;kCAGvE,4PAAC;wBAAE,WAAU;;0CACT,4PAAC;0CAAK;;;;;;4BAAqB;0CAAC,4PAAC;gCAAK,WAAU;;oCAAe;oCAAE,aAAa,OAAO,CAAC;;;;;;;;;;;;;;;;;;;0BAI1F,4PAAC;gBACG,SAAS;gBACT,UAAU;gBACV,WAAW,CAAC,8FAA8F,EAAE,UAAU;0BAErH,0BACG;;sCACI,4PAAC,uMAAe;4BAAC,MAAM,mMAAS;4BAAE,IAAI;4BAAC,WAAU;;;;;;wBAAS;;mCAI9D;;;;;;;;;;;;AAKpB;uCAEe"}},
    {"offset": {"line": 1135, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/admin/Desktop/next-shiprocket/shiprocket/src/app/components/CheckoutLayout.js"],"sourcesContent":["// shiprocket/src/app/components/CheckoutLayout.js\r\n\r\n\"use client\"; \r\n\r\nimport React, { useState } from 'react';\r\nimport LoginStep from './LoginStep';\r\nimport AddressStep from './AddressStep';\r\nimport PaymentStep from './PaymentStep';\r\n\r\nconst STEPS = {\r\n    LOGIN: 1,\r\n    ADDRESS: 2,\r\n    PAYMENT: 3,\r\n};\r\n\r\nconst CheckoutLayout = () => {\r\n    const [currentStep, setCurrentStep] = useState(STEPS.LOGIN);\r\n    const [userData, setUserData] = useState(null); \r\n    const [addressData, setAddressData] = useState(null); \r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    // üî¥ 1. CRITICAL: Item details for Shopify. REPLACE VARIANT_ID and NAME.\r\n    const [initialOrderItems] = useState([{\r\n        // Example product with base price (1250)\r\n        variant_id: 45678901234567, // <--- REPLACE THIS WITH A VALID VARIANT ID\r\n        name: \"Shiprocket Integration Service\", \r\n        quantity: 1,\r\n        base_price: 1250 \r\n    }]);\r\n\r\n    const handleLoginSuccess = (data) => {\r\n        setUserData(data);\r\n        if (data.address_found) {\r\n            setAddressData(data.address);\r\n        }\r\n        setCurrentStep(STEPS.ADDRESS);\r\n    };\r\n\r\n    const handleAddressConfirm = (data) => {\r\n        setAddressData(data);\r\n        setCurrentStep(STEPS.PAYMENT);\r\n    };\r\n\r\n    // --- API Call to Simulated MongoDB & Shopify Backend ---\r\n    const handleOrderPlace = async () => {\r\n        \r\n        if (!userData || !addressData || !addressData.paymentDetails) {\r\n            alert(\"Error: Missing user or payment data.\");\r\n            return;\r\n        }\r\n\r\n        setIsLoading(true); \r\n\r\n        const orderDataToSend = {\r\n            userId: userData.mobile,\r\n            userName: userData.name,\r\n            shippingAddress: addressData,\r\n            paymentSummary: addressData.paymentDetails,\r\n            orderItems: initialOrderItems, \r\n            status: \"Processing\"\r\n        };\r\n        \r\n        const finalTotal = addressData.paymentDetails.totalPayable.toFixed(2);\r\n        \r\n        try {\r\n            const response = await fetch('/api/place-order', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                },\r\n                body: JSON.stringify(orderDataToSend)\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const errorData = await response.json();\r\n                throw new Error(errorData.detailedError || errorData.message || `HTTP error! Status: ${response.status}`);\r\n            }\r\n\r\n            const result = await response.json();\r\n            \r\n            alert(`‚úÖ Order Placed Successfully! Shopify ID: ${result.shopifyId}. Final Total: ‚Çπ${finalTotal}.`);\r\n            \r\n            // Reset state after successful order placement\r\n            setUserData(null);\r\n            setAddressData(null);\r\n            setCurrentStep(STEPS.LOGIN);\r\n\r\n        } catch (error) {\r\n            console.error(\"Error placing order:\", error);\r\n            alert(`‚ùå Order failed due to a server/API error. Details: ${error.message}`);\r\n        } finally {\r\n            setIsLoading(false); \r\n        }\r\n    };\r\n    // -------------------------------------------------------------\r\n\r\n    const renderStep = () => {\r\n        switch (currentStep) {\r\n            case STEPS.LOGIN:\r\n                return <LoginStep onLoginSuccess={handleLoginSuccess} />;\r\n            case STEPS.ADDRESS:\r\n                return (\r\n                    <AddressStep \r\n                        initialAddress={addressData} \r\n                        onAddressConfirm={handleAddressConfirm} \r\n                        userName={userData?.name || \"Customer\"}\r\n                    />\r\n                );\r\n            case STEPS.PAYMENT:\r\n                return (\r\n                    <PaymentStep \r\n                        onOrderPlace={handleOrderPlace} \r\n                        initialOrderItems={initialOrderItems}\r\n                        onFinalizeAddress={setAddressData}\r\n                        isLoading={isLoading} \r\n                    />\r\n                );\r\n            default:\r\n                return <LoginStep onLoginSuccess={handleLoginSuccess} />;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-full max-w-xl mx-auto p-4\">\r\n            <h1 className=\"text-3xl font-bold text-center mb-6 text-gray-800\">\r\n                üöÄ Custom Fast Checkout ({currentStep}/3)\r\n            </h1>\r\n            \r\n            <div className=\"bg-white shadow-2xl rounded-xl p-6\">\r\n                {renderStep()}\r\n            </div>\r\n            \r\n            {/* üî¥ NEW: Security and Trust Indicators */}\r\n            <div className=\"mt-6 p-3 bg-white border border-green-200 rounded-lg text-center text-sm shadow-md\">\r\n                <p className=\"font-bold text-green-700\">üîí 100% Secure Checkout</p>\r\n                <p className=\"text-gray-500 mt-1\">\r\n                    All payments are encrypted. 7-Day Easy Return Guarantee applies.\r\n                </p>\r\n            </div>\r\n            \r\n            <div className=\"mt-4 text-center text-xs text-gray-500\">\r\n                <p>Note: Check your server terminal for Shopify API errors (SHOPIFY ERROR DETAILS).</p>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default CheckoutLayout;"],"names":[],"mappings":"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"}}]
}